!function(context,win){function serial(e){var t=e.name;if(e.disabled||!t)return"";t=enc(t);switch(e.tagName.toLowerCase()){case"input":switch(e.type){case"reset":case"button":case"image":case"file":return"";case"checkbox":case"radio":return e.checked?t+"="+(e.value?enc(e.value):!0)+"&":"";default:return t+"="+(e.value?enc(e.value):"")+"&"}break;case"textarea":return t+"="+enc(e.value)+"&";case"select":return t+"="+enc(e.options[e.selectedIndex].value)+"&"}return""}function enc(e){return encodeURIComponent(e)}function reqwest(e,t){return new Reqwest(e,t)}function init(o,fn){function error(e){o.error&&o.error(e),complete(e)}function success(resp){o.timeout&&clearTimeout(self.timeout)&&(self.timeout=null);var r=resp.responseText;if(r)switch(type){case"json":resp=win.JSON?win.JSON.parse(r):eval("("+r+")");break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function complete(e){o.complete&&o.complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort(),error()},o.timeout)),this.request=getRequest(o,success,error)}function setType(e){return/\.json$/.test(e)?"json":/\.jsonp$/.test(e)?"jsonp":/\.js$/.test(e)?"js":/\.html?$/.test(e)?"html":/\.xml$/.test(e)?"xml":"js"}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function getRequest(e,t,n){if(e.type!="jsonp"){var r=xhr();return r.open(e.method||"GET",typeof e=="string"?e:e.url,!0),setHeaders(r,e),r.onreadystatechange=handleReadyState(r,t,n),e.before&&e.before(r),r.send(e.data||null),r}var i=doc.createElement("script"),s=0;win[getCallbackName(e)]=generalCallback,i.type="text/javascript",i.src=e.url,i.async=!0,i.onload=i.onreadystatechange=function(){if(i[readyState]&&i[readyState]!=="complete"&&i[readyState]!=="loaded"||s)return!1;i.onload=i.onreadystatechange=null,e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(i),s=1},head.appendChild(i)}function generalCallback(e){lastValue=e}function getCallbackName(e){var t=e.jsonpCallback||"callback";if(e.url.slice(-(t.length+2))==t+"=?"){var n="reqwest_"+uniqid++;return e.url=e.url.substr(0,e.url.length-1)+n,n}var r=new RegExp(t+"=([\\w]+)");return e.url.match(r)[1]}function setHeaders(e,t){var n=t.headers||{};n.Accept=n.Accept||"text/javascript, text/html, application/xml, text/xml, */*",t.crossOrigin||(n["X-Requested-With"]=n["X-Requested-With"]||"XMLHttpRequest"),n[contentType]=n[contentType]||"application/x-www-form-urlencoded";for(var r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r],!1)}function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}var twoHundo=/^20\d$/,doc=document,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",head=doc[byTag]("head")[0],uniqid=0,lastValue,xhr="XMLHttpRequest"in win?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serialize=function(e){var t=[e[byTag]("input"),e[byTag]("select"),e[byTag]("textarea")],n=[],r,i;for(r=0,l=t.length;r<l;++r)for(i=0,l2=t[r].length;i<l2;++i)n.push(serial(t[r][i]));return n.join("").replace(/&$/,"")},reqwest.serializeArray=function(e){for(var t=this.serialize(e).split("&"),n=0,r=t.length,i=[],s;n<r;n++)t[n]&&(s=t[n].split("="))&&i.push({name:s[0],value:s[1]});return i};var old=context.reqwest;reqwest.noConflict=function(){return context.reqwest=old,this},typeof module!="undefined"?module.exports=reqwest:context.reqwest=reqwest}(this,window);var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(e){function o(e){e=t(e);if(n.hasOwnProperty(e))return n[e];var r=e.match(i);return r?String.fromCharCode(parseInt(r[1],10)):(r=e.match(s))?String.fromCharCode(parseInt(r[1],16)):""}function u(e,t){return o(t)}function f(e){return e.replace(a,"")}function c(e){return e.replace(l,u)}function y(e){return e.replace(h,"&amp;").replace(d,"&lt;").replace(v,"&gt;").replace(m,"&#34;").replace(g,"&#61;")}function b(e){return e.replace(p,"&amp;$1").replace(d,"&lt;").replace(v,"&gt;")}function S(n){return function(i,s){i=String(i);var o=null,u=!1,a=[],l=void 0,h=void 0,p=void 0;n.startDoc&&n.startDoc(s);while(i){var d=i.match(u?w:E);i=i.substring(d[0].length);if(u){if(d[1]){var v=t(d[1]),m;if(d[2]){var g=d[3];switch(g.charCodeAt(0)){case 34:case 39:g=g.substring(1,g.length-1)}m=c(f(g))}else m=v;a.push(v,m)}else if(d[4]){h!==void 0&&(p?n.startTag&&n.startTag(l,a,s):n.endTag&&n.endTag(l,s));if(p&&h&(e.eflags.CDATA|e.eflags.RCDATA)){o===null?o=t(i):o=o.substring(o.length-i.length);var y=o.indexOf("</"+l);y<0&&(y=i.length),y&&(h&e.eflags.CDATA?n.cdata&&n.cdata(i.substring(0,y),s):n.rcdata&&n.rcdata(b(i.substring(0,y)),s),i=i.substring(y))}l=h=p=void 0,a.length=0,u=!1}}else if(d[1])n.pcdata&&n.pcdata(d[0],s);else if(d[3])p=!d[2],u=!0,l=t(d[3]),h=e.ELEMENTS.hasOwnProperty(l)?e.ELEMENTS[l]:void 0;else if(d[4])n.pcdata&&n.pcdata(d[4],s);else if(d[5]&&n.pcdata){var S=d[5];n.pcdata(S==="<"?"&lt;":S===">"?"&gt;":"&amp;",s)}}n.endDoc&&n.endDoc(s)}}function x(t){var n,r;return S({startDoc:function(e){n=[],r=!1},startTag:function(i,s,o){if(r)return;if(!e.ELEMENTS.hasOwnProperty(i))return;var u=e.ELEMENTS[i];if(u&e.eflags.FOLDABLE)return;if(u&e.eflags.UNSAFE){r=!(u&e.eflags.EMPTY);return}s=t(i,s);if(s){u&e.eflags.EMPTY||n.push(i),o.push("<",i);for(var a=0,f=s.length;a<f;a+=2){var l=s[a],c=s[a+1];c!==null&&c!==void 0&&o.push(" ",l,'="',y(c),'"')}o.push(">")}},endTag:function(t,i){if(r){r=!1;return}if(!e.ELEMENTS.hasOwnProperty(t))return;var s=e.ELEMENTS[t];if(!(s&(e.eflags.UNSAFE|e.eflags.EMPTY|e.eflags.FOLDABLE))){var o;if(s&e.eflags.OPTIONAL_ENDTAG)for(o=n.length;--o>=0;){var u=n[o];if(u===t)break;if(!(e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG))return}else for(o=n.length;--o>=0;)if(n[o]===t)break;if(o<0)return;for(var a=n.length;--a>o;){var u=n[a];e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG||i.push("</",u,">")}n.length=o,i.push("</",t,">")}},pcdata:function(e,t){r||t.push(e)},rcdata:function(e,t){r||t.push(e)},cdata:function(e,t){r||t.push(e)},endDoc:function(e){for(var t=n.length;--t>=0;)e.push("</",n[t],">");n.length=0}})}function N(t,n,i){var s=[];return x(function(s,o){for(var u=0;u<o.length;u+=2){var a=o[u],f=o[u+1],l=null,c;if((c=s+"::"+a,e.ATTRIBS.hasOwnProperty(c))||(c="*::"+a,e.ATTRIBS.hasOwnProperty(c)))l=e.ATTRIBS[c];if(l!==null)switch(l){case e.atype.NONE:break;case e.atype.SCRIPT:case e.atype.STYLE:f=null;break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:f=i?i(f):f;break;case e.atype.URI:var h=(""+f).match(T);h?!h[1]||r.test(h[1])?f=n&&n(f):f=null:f=null;break;case e.atype.URI_FRAGMENT:f&&"#"===f.charAt(0)?(f=i?i(f):f,f&&(f="#"+f)):f=null;break;default:f=null}else f=null;o[u+1]=f}return o})(t,s),s.join("")}var t;"script"==="SCRIPT".toLowerCase()?t=function(e){return e.toLowerCase()}:t=function(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)|32)})};var n={lt:"<",gt:">",amp:"&",nbsp:"Â ",quot:'"',apos:"'"},r=/^(?:https?|mailto|data)$/i,i=/^#(\d+)$/,s=/^#x([0-9A-Fa-f]+)$/,a=/\0/g,l=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,h=/&/g,p=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,d=/</g,v=/>/g,m=/\"/g,g=/\=/g,w=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),E=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),T=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:y,makeHtmlSanitizer:x,makeSaxParser:S,normalizeRCData:b,sanitize:N,unescapeEntities:c}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0;var Mustache=function(){var e={},t=function(){};return t.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(e,t,n,r){r||(this.context=t,this.buffer=[]);if(!this.includes("",e)){if(r)return e;this.send(e);return}e=this.render_pragmas(e);var i=this.render_section(e,t,n);i===!1&&(i=this.render_tags(e,t,n,r));if(r)return i;this.sendLines(i)},send:function(e){e!==""&&this.buffer.push(e)},sendLines:function(e){if(e){var t=e.split("\n");for(var n=0;n<t.length;n++)this.send(t[n])}},render_pragmas:function(e){if(!this.includes("%",e))return e;var t=this,n=this.getCachedRegex("render_pragmas",function(e,t){return new RegExp(e+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+t,"g")});return e.replace(n,function(e,n,r){if(!t.pragmas_implemented[n])throw{message:"This implementation of mustache doesn't understand the '"+n+"' pragma"};t.pragmas[n]={};if(r){var i=r.split("=");t.pragmas[n][i[0]]=i[1]}return""})},render_partial:function(e,t,n){e=this.trim(e);if(!n||n[e]===undefined)throw{message:"unknown_partial '"+e+"'"};return typeof t[e]!="object"?this.render(n[e],t,n,!0):this.render(n[e],t[e],n,!0)},render_section:function(e,t,n){if(!this.includes("#",e)&&!this.includes("^",e))return!1;var r=this,i=this.getCachedRegex("render_section",function(e,t){return new RegExp("^([\\s\\S]*?)"+e+"(\\^|\\#)\\s*(.+)\\s*"+t+"\n*([\\s\\S]*?)"+e+"\\/\\s*\\3\\s*"+t+"\\s*([\\s\\S]*)$","g")});return e.replace(i,function(e,i,s,o,u,a){var f=i?r.render_tags(i,t,n,!0):"",l=a?r.render(a,t,n,!0):"",c,h=r.find(o,t);return s==="^"?!h||r.is_array(h)&&h.length===0?c=r.render(u,t,n,!0):c="":s==="#"&&(r.is_array(h)?c=r.map(h,function(e){return r.render(u,r.create_context(e),n,!0)}).join(""):r.is_object(h)?c=r.render(u,r.create_context(h),n,!0):typeof h=="function"?c=h.call(t,u,function(e){return r.render(e,t,n,!0)}):h?c=r.render(u,t,n,!0):c=""),f+c+l})},render_tags:function(e,t,n,r){var i=this,s=function(){return i.getCachedRegex("render_tags",function(e,t){return new RegExp(e+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+t+"+","g")})},o=s(),u=function(e,r,u){switch(r){case"!":return"";case"=":return i.set_delimiters(u),o=s(),"";case">":return i.render_partial(u,t,n);case"{":return i.find(u,t);default:return i.escape(i.find(u,t))}},a=e.split("\n");for(var f=0;f<a.length;f++)a[f]=a[f].replace(o,u,this),r||this.send(a[f]);if(r)return a.join("\n")},set_delimiters:function(e){var t=e.split(" ");this.otag=this.escape_regex(t[0]),this.ctag=this.escape_regex(t[1])},escape_regex:function(e){if(!arguments.callee.sRE){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,t){function n(e){return e===!1||e===0||e}e=this.trim(e);var r;return n(t[e])?r=t[e]:n(this.context[e])&&(r=this.context[e]),typeof r=="function"?r.apply(t):r!==undefined?r:""},includes:function(e,t){return t.indexOf(this.otag+e)!=-1},escape:function(e){return e=String(e===null?"":e),e.replace(/&(?!\w+;)|["'<>\\]/g,function(e){switch(e){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return e}})},create_context:function(e){if(this.is_object(e))return e;var t=".";this.pragmas["IMPLICIT-ITERATOR"]&&(t=this.pragmas["IMPLICIT-ITERATOR"].iterator);var n={};return n[t]=e,n},is_object:function(e){return e&&typeof e=="object"},is_array:function(e){return Object.prototype.toString.call(e)==="[object Array]"},trim:function(e){return e.replace(/^\s*|\s*$/g,"")},map:function(e,t){if(typeof e.map=="function")return e.map(t);var n=[],r=e.length;for(var i=0;i<r;i++)n.push(t(e[i]));return n},getCachedRegex:function(t,n){var r=e[this.otag];r||(r=e[this.otag]={});var i=r[this.ctag];i||(i=r[this.ctag]={});var s=i[t];return s||(s=i[t]=n(this.otag,this.ctag)),s}},{name:"mustache.js",version:"0.4.0-dev",to_html:function(e,n,r,i){var s=new t;i&&(s.send=i),s.render(e,n||{},r);if(!i)return s.buffer.join("\n")}}}();wax=wax||{},wax.attribution=function(){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var e,t={};return t.set=function(t){if(typeof t=="undefined")return;return e.innerHTML=html_sanitize(t,n,r),this},t.element=function(){return e},t.init=function(){return e=document.createElement("div"),e.className="wax-attribution",this},t.init()},wax=wax||{},wax.bwdetect=function(e,t){function a(){wax.bw=-1;var e=new Image;e.src=s;var t=!0,i=setTimeout(function(){t&&wax.bw==-1&&(n.bw(0),t=!1)},r);e.onload=function(){t&&wax.bw==-1&&(clearTimeout(i),n.bw(1),t=!1)}}var n={},r=e.threshold||400,s="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),o=1,u=e.auto===undefined?!0:e.auto;return n.bw=function(e){if(!arguments.length)return o;var n=o;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](e)}(),wax.bw=e,o!=(o=e)&&t(e)},n.add=function(){return u&&a(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(n.bw)):wax.bw!==undefined?n.bw(wax.bw):n.add(),n},wax.formatter=function(x){function urlX(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function idX(e){return e}var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(e,t){try{return html_sanitize(f(e,t),urlX,idX)}catch(n){console&&console.log(n)}},formatter},wax.GridInstance=function(e,t,n){function o(e){return e>=93&&e--,e>=35&&e--,e-=32,e}n=n||{};var r={},i=n.resolution||4,s=n.tileSize||256;return r.grid_tile=function(){return e},r.getKey=function(t,n){if(!e||!e.grid)return;if(n<0||t<0)return;if(Math.floor(n)>=s||Math.floor(t)>=s)return;return o(e.grid[Math.floor(n/i)].charCodeAt(Math.floor(t/i)))},r.gridFeature=function(t,n){var r=this.getKey(t,n),i=e.keys;if(i&&i[r]&&e.data[i[r]])return e.data[i[r]]},r.tileFeature=function(n,r,i,s){if(!e)return;var o=wax.util.offset(i);feature=this.gridFeature(n-o.left,r-o.top);if(feature)return t.format(s,feature)},r},wax.GridManager=function(e){function u(e){return typeof e=="string"&&(e=[e]),function(n){if(!n)return;var r=/(\d+)\/(\d+)\/(\d+)\.[\w\._]+/g.exec(n);if(!r)return;return e[parseInt(r[2],10)%e.length].replace("{z}",r[1]).replace("{x}",r[2]).replace("{y}",r[3])}}e=e||{};var t=e.resolution||4,n=e.version||"1.1",r={},i={},s,o=function(e){return e.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return i.formatter=function(e){return arguments.length?(s=wax.formatter(e),i):s},i.template=function(e){return arguments.length?(s=wax.template(e),i):s},i.gridUrl=function(e){return arguments.length?(o=typeof e=="function"?e:u(e),i):o},i.getGrid=function(e,n){var r=o(e);return!s||!r?n(null,null):(wax.request.get(r,function(e,r){if(e)return n(e,null);n(null,wax.GridInstance(r,s,{resolution:t||4}))}),i)},i.add=function(e){return e.template?i.template(e.template):e.formatter&&i.formatter(e.formatter),e.grids&&i.gridUrl(e.grids),this},i.add(e)},wax=wax||{},wax.hash=function(e){function t(){return location.hash.substring(1)}function n(e){location.hash="#"+e}function o(t){var n=t.split("/");for(var r=0;r<n.length;r++){n[r]=Number(n[r]);if(isNaN(n[r]))return!0}if(n.length<3)return!0;n.length==3&&e.setCenterZoom(n)}function u(){var t=e.getCenterZoom();r!==t&&(r=t,n(r))}function a(e){if(e===r)return;o(r=e)&&u()}e=e||{};var r,i={},s=90-1e-8,f=wax.util.throttle(u,500);return i.add=function(){return a(t()),e.bindChange(f),this},i.remove=function(){return e.unbindChange(f),this},i.add()};var wax=wax||{};wax.legend=function(){function r(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function i(e){return e}var e,t={},n;return t.element=function(){return n},t.content=function(t){return arguments.length?(t?(e.innerHTML=html_sanitize(t,r,i),e.style.display="block"):(e.innerHTML="",e.style.display="none"),this):e.innerHTML},t.add=function(){return n=document.createElement("div"),n.className="wax-legends",e=document.createElement("div"),e.className="wax-legend",e.style.display="none",n.appendChild(e),this},t.add()};var w=function(e){return e.melt=function(t,n){return t.apply(n,[e,n])},e},wax=wax||{};wax.movetip={},wax.movetip=function(e){function o(e){return e&&e.className.indexOf("wax-popup")!==-1}function u(e,t){var n=document.createElement("div");return n.className="wax-movetip",n.style.cssText="position:absolute;",n.innerHTML=e,t.appendChild(n),r=t,_tooltipOffset=wax.util.offset(n),_contextOffset=wax.util.offset(r),n}function a(e){if(!n)return;var t=wax.util.eventoffset(e);n.className="wax-movetip",_tooltipOffset.height+t.y>_contextOffset.top+_contextOffset.height&&_contextOffset.height>_tooltipOffset.height&&(t.y-=_tooltipOffset.height,n.className+=" flip-y"),_tooltipOffset.width+t.x>_contextOffset.left+_contextOffset.width&&(t.x-=_tooltipOffset.width,n.className+=" flip-x"),n.style.left=t.x+"px",n.style.top=t.y+"px"}function f(e){if(!e)return;var t,n=function(){this.parentNode&&this.parentNode.removeChild(this)};e.style["-webkit-transition"]!==undefined&&i?t="webkitTransitionEnd":e.style.MozTransition!==undefined&&i&&(t="transitionend"),t?(e.addEventListener(t,n,!1),e.addEventListener("transitionend",n,!1),e.className+=" "+i):e.parentNode&&e.parentNode.removeChild(e)}function l(e,t){n&&(f(n),n=undefined);var r=u(e,t);r.className+=" wax-popup",r.innerHTML=e;var i=document.createElement("a");i.href="#close",i.className="close",i.innerHTML="Close",r.appendChild(i);var s=function(e){return f(r),n=undefined,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1};i.addEventListener?i.addEventListener("click",s,!1):i.attachEvent&&i.attachEvent("onclick",s),n=r}e=e||{};var t={},n=undefined,r=undefined,i=e.animationOut,s=e.animationIn;return t.over=function(e,t,r){if(!e)return;t.style.cursor="pointer";if(o(n))return;n=u(e,t),a(r),t.addEventListener&&t.addEventListener("mousemove",a)},t.out=function(e){e.style.cursor="default";if(o(n))return;n&&(f(n),e.removeEventListener&&e.removeEventListener("mousemove",a),n=undefined)},t};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(e,t){if(this.cache[e])return t(this.cache[e][0],this.cache[e][1]);this.promises[e]=this.promises[e]||[],this.promises[e].push(t);if(this.locks[e])return;var n=this;this.locks[e]=!0,reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(t){n.locks[e]=!1,n.cache[e]=[null,t];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])},error:function(t){n.locks[e]=!1,n.cache[e]=[t,null];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])}})}},wax.template=function(e){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var t={};return t.format=function(t,i){var s={};for(var o in i)s[o]=i[o];return t.format&&(s["__"+t.format+"__"]=!0),html_sanitize(Mustache.to_html(e,s),n,r)},t};if(!wax)var wax={};wax.tilejson=function(e,t){reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:t,error:t})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(e){this._currentTooltip=undefined,e=e||{},e.animationOut&&(this.animationOut=e.animationOut),e.animationIn&&(this.animationIn=e.animationIn)},wax.tooltip.prototype.isPopup=function(e){return e&&e.className.indexOf("wax-popup")!==-1},wax.tooltip.prototype.getTooltip=function(e,t){var n=document.createElement("div");return n.className="wax-tooltip wax-tooltip-0",n.innerHTML=e,t.appendChild(n),n},wax.tooltip.prototype.hideTooltip=function(e){if(!e)return;var t,n=function(){this.parentNode&&this.parentNode.removeChild(this)};e.style["-webkit-transition"]!==undefined&&this.animationOut?t="webkitTransitionEnd":e.style.MozTransition!==undefined&&this.animationOut&&(t="transitionend"),t?(e.addEventListener(t,n,!1),e.addEventListener("transitionend",n,!1),e.className+=" "+this.animationOut):e.parentNode&&e.parentNode.removeChild(e)},wax.tooltip.prototype.click=function(e,t){this._currentTooltip&&(this.hideTooltip(this._currentTooltip),this._currentTooltip=undefined);var n=this.getTooltip(e,t);n.className+=" wax-popup",n.innerHTML=e;var r=document.createElement("a");r.href="#close",r.className="close",r.innerHTML="Close",n.appendChild(r);var i=wax.util.bind(function(e){return this.hideTooltip(n),this._currentTooltip=undefined,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},this);r.addEventListener?r.addEventListener("click",i,!1):r.attachEvent&&r.attachEvent("onclick",i),this._currentTooltip=n},wax.tooltip.prototype.over=function(e,t){if(!e)return;t.style.cursor="pointer";if(this.isPopup(this._currentTooltip))return;this._currentTooltip=this.getTooltip(e,t)},wax.tooltip.prototype.out=function(e){e.style.cursor="default";if(this.isPopup(this._currentTooltip))return;this._currentTooltip&&(this.hideTooltip(this._currentTooltip),this._currentTooltip=undefined)};var wax=wax||{};wax.util=wax.util||{},wax.util={offset:function(e){var t=e.offsetWidth||parseInt(e.style.width,10),n=e.offsetHeight||parseInt(e.style.height,10),r=document.body,i=0,s=0,o=function(e){if(e===r||e===document.documentElement)return;i+=e.offsetTop,s+=e.offsetLeft;var t=e.style.transform||e.style.WebkitTransform||e.style.OTransform||e.style.MozTransform||e.style.msTransform;if(t)if(match=t.match(/translate\((.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/matrix3d\(([\-\d,\s]+)\)/)){var n=match[1].split(",");i+=parseInt(n[13],10),s+=parseInt(n[12],10)}else if(match=t.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10)};o(e);try{while(e=e.offsetParent)o(e)}catch(u){}i+=r.offsetTop,s+=r.offsetLeft,i+=r.parentNode.offsetTop,s+=r.parentNode.offsetLeft;var a=document.defaultView?window.getComputedStyle(r.parentNode,null):r.parentNode.currentStyle;return r.parentNode.offsetTop!==parseInt(a.marginTop,10)&&!isNaN(parseInt(a.marginTop,10))&&(i+=parseInt(a.marginTop,10),s+=parseInt(a.marginLeft,10)),{top:i,left:s,height:n,width:t}},$:function(e){return typeof e=="string"?document.getElementById(e):e},bind:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}},isString:function(e){return!!(e===""||e&&e.charCodeAt&&e.substr)},indexOf:function(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;var r,i;if(n&&e.indexOf===n)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},keys:Object.keys||function(e){var t=Object.prototype.hasOwnProperty;if(e!==Object(e))throw new TypeError("Invalid object");var n=[];for(var r in e)t.call(e,r)&&(n[n.length]=r);return n},eventoffset:function(e){var t=0,n=0;if(!e)var e=window.event;if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};if(e.clientX||e.clientY){var r=document.documentElement,i=document.body,s=document.body.parentNode.currentStyle,o=parseInt(s.marginTop,10)||0,u=parseInt(s.marginLeft,10)||0;return{x:e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)+u,y:e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)+o}}if(e.touches&&e.touches.length===1)return{x:e.touches[0].pageX,y:e.touches[0].pageY}},limit:function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}},throttle:function(e,t){return this.limit(e,t,!1)},parseUri:function(e){var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r},addUrlData:function(e,t){return e+=this.parseUri(e).query?"&":"?",e+=t}},wax=wax||{},wax.g=wax.g||{},wax.g.attribution=function(e,t){t=t||{};var n,r={};return r.element=function(){return n.element()},r.appendTo=function(e){return wax.util.$(e).appendChild(n.element()),this},r.init=function(){return n=wax.attribution(),n.set(t.attribution),n.element().className="wax-attribution wax-g",this},r.init()},wax=wax||{},wax.g=wax.g||{},wax.g.bwdetect=function(e,t){t=t||{};var n=t.png||".png128",r=t.jpg||".jpg70";if(!e.mapTypes["mb-low"]){var i=e.mapTypes.mb,s={tiles:[],scheme:i.options.scheme,blankImage:i.options.blankImage,minzoom:i.minZoom,maxzoom:i.maxZoom,name:i.name,description:i.description};for(var o=0;o<i.options.tiles.length;o++)s.tiles.push(i.options.tiles[o].replace(".png",n).replace(".jpg",r));m.mapTypes.set("mb-low",new wax.g.connector(s))}return wax.bwdetect(t,function(t){e.setMapTypeId(t?"mb":"mb-low")})},wax=wax||{},wax.g=wax.g||{},wax.g.hash=function(e){return wax.hash({getCenterZoom:function(){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2));return[n.toFixed(2),t.lat().toFixed(r),t.lng().toFixed(r)].join("/")},setCenterZoom:function(n){e.setCenter(new google.maps.LatLng(n[1],n[2])),e.setZoom(n[0])},bindChange:function(t){google.maps.event.addListener(e,"idle",t)},unbindChange:function(t){google.maps.event.removeListener(e,"idle",t)}})},wax=wax||{},wax.g=wax.g||{},wax.g.interaction=function(e,t,n){t=t||{},n=n||{};var r={waxGM:new wax.GridManager(t),callbacks:n.callbacks||new wax.tooltip,clickAction:n.clickAction||"full",eventHandlers:{},add:function(){return this.eventHandlers.tileloaded=google.maps.event.addListener(e,"tileloaded",wax.util.bind(this.clearTileGrid,this)),this.eventHandlers.idle=google.maps.event.addListener(e,"idle",wax.util.bind(this.clearTileGrid,this)),this.eventHandlers.mousemove=google.maps.event.addListener(e,"mousemove",this.onMove()),this.eventHandlers.click=google.maps.event.addListener(e,"click",this.click()),this},remove:function(){return google.maps.event.removeListener(this.eventHandlers.tileloaded),google.maps.event.removeListener(this.eventHandlers.idle),google.maps.event.removeListener(this.eventHandlers.mousemove),google.maps.event.removeListener(this.eventHandlers.click),this},getTileGrid:function(){if(!this._getTileGrid){this._getTileGrid=[];var t=e.getZoom(),n=wax.util.offset(e.getDiv()),r=wax.util.bind(function(e){if(!e.interactive)return;for(var r in e.cache){if(r.split("/")[0]!=t)continue;var i=wax.util.offset(e.cache[r]);this._getTileGrid.push([i.top-n.top,i.left-n.left,e.cache[r]])}},this);for(var i in e.mapTypes)r(e.mapTypes[i]);e.overlayMapTypes.forEach(r)}return this._getTileGrid},clearTileGrid:function(e,t){this._getTileGrid=null},getTile:function(e){var t,n=this.getTileGrid();for(var r=0;r<n.length;r++
)if(n[r][0]<e.pixel.y&&n[r][0]+256>e.pixel.y&&n[r][1]<e.pixel.x&&n[r][1]+256>e.pixel.x){t=n[r][2];break}return t||!1},onMove:function(t){return this._onMove||(this._onMove=wax.util.bind(function(t){var n=this.getTile(t);n&&this.waxGM.getGrid(n.src,wax.util.bind(function(r,i){if(r||!i)return;var s=i.tileFeature(t.pixel.x+wax.util.offset(e.getDiv()).left,t.pixel.y+wax.util.offset(e.getDiv()).top,n,{format:"teaser"});s&&this.feature!==s?(this.feature=s,this.callbacks.out(e.getDiv()),this.callbacks.over(s,e.getDiv(),0,t)):s||(this.feature=null,this.callbacks.out(e.getDiv()))},this))},this)),this._onMove},click:function(t){return this._onClick||(this._onClick=wax.util.bind(function(t){if(window.event&&window.event.cancelBubble)return!1;var n=this.getTile(t);n&&this.waxGM.getGrid(n.src,wax.util.bind(function(r,i){if(r||!i)return;var s=i.tileFeature(t.pixel.x+wax.util.offset(e.getDiv()).left,t.pixel.y+wax.util.offset(e.getDiv()).top,n,{format:this.clickAction});if(s){window.event||(window.event={},setTimeout(function(){window.event=null},150)),window.event.cancelBubble=!0;switch(this.clickAction){case"full":this.callbacks.click(s,e.getDiv(),0,t);break;case"location":window.location=s}}},this))},this)),this._onClick}};return r.add(e)},wax=wax||{},wax.g=wax.g||{},wax.g.legend=function(e,t){t=t||{};var n,r={};return r.add=function(){return n=wax.legend().content(t.legend||""),this},r.element=function(){return n.element()},r.appendTo=function(e){return wax.util.$(e).appendChild(n.element()),this},r.add()};var wax=wax||{};wax.g=wax.g||{},wax.g.connector=function(e){e=e||{},this.options={tiles:e.tiles,scheme:e.scheme||"xyz",blankImage:e.blankImage},this.minZoom=e.minzoom||0,this.maxZoom=e.maxzoom||22,this.name=e.name||"",this.description=e.description||"",this.interactive=!0,this.tileSize=new google.maps.Size(256,256),this.cache={}},wax.g.connector.prototype.getTile=function(e,t,n){var r=t+"/"+e.x+"/"+e.y;if(!this.cache[r]){var i=this.cache[r]=new Image(256,256);this.cache[r].src=this.getTileUrl(e,t),this.cache[r].setAttribute("gTileKey",r),this.cache[r].onerror=function(){i.style.display="none"}}return this.cache[r]},wax.g.connector.prototype.releaseTile=function(e){var t=e.getAttribute("gTileKey");this.cache[t]&&delete this.cache[t],e.parentNode&&e.parentNode.removeChild(e)},wax.g.connector.prototype.getTileUrl=function(e,t){var n=Math.pow(2,t),r=this.options.scheme==="tms"?n-1-e.y:e.y,i=e.x%n;return i=i<0?e.x%n+n:i,r<0?this.options.blankImage:this.options.tiles[parseInt(i+r,10)%this.options.tiles.length].replace("{z}",t).replace("{x}",i).replace("{y}",r)};var CartoDB=CartoDB||{};(function(e){typeof google.maps.CartoDBLayer=="undefined"&&(google.maps.CartoDBLayer=function(t){function n(t){t.map_key||e.ajax({url:"http://"+t.user_name+".cartodb.com/api/v1/sql/?q="+escape("select ST_Extent(the_geom) from "+t.table_name),dataType:"jsonp",timeout:2e3,callbackParameter:"callback",success:function(e){if(e.rows[0].st_extent!=null){var n=e.rows[0].st_extent.replace("BOX(","").replace(")","").split(","),r=n[0].split(" "),i=n[1].split(" "),s=new google.maps.LatLngBounds;if(r[0]>180||r[0]<-180||r[1]>90||r[1]<-90||i[0]>180||i[0]<-180||i[1]>90||i[1]<-90)r[0]="-30",r[1]="-50",i[0]="110",i[1]="80";s.extend(new google.maps.LatLng(r[1],r[0])),s.extend(new google.maps.LatLng(i[1],i[0])),t.map.fitBounds(s)}},error:function(e,n){t.debug&&console.debug("Error setting table bounds: "+n)}})}function r(t){e.ajax({url:"http://"+t.user_name+".cartodb.com/tiles/"+t.table_name+"/map_metadata?"+"map_key="+(t.map_key||""),dataType:"jsonp",timeout:2e3,callbackParameter:"callback",success:function(n){var r=e.parseJSON(n.map_metadata);if(!r||r.google_maps_base_type=="roadmap")t.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP});else if(r.google_maps_base_type=="satellite")t.map.setOptions({mapTypeId:google.maps.MapTypeId.SATELLITE});else if(r.google_maps_base_type=="terrain")t.map.setOptions({mapTypeId:google.maps.MapTypeId.TERRAIN});else{var i=[{stylers:[{saturation:-65},{gamma:1.52}]},{featureType:"administrative",stylers:[{saturation:-95},{gamma:2.26}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"simplified"},{saturation:-99},{gamma:2.22}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{saturation:-55}]}];r.google_maps_customization_style=i,t.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP})}r||(r={google_maps_customization_style:[]}),t.map.setOptions({styles:r.google_maps_customization_style})},error:function(e,n){t.debug&&console.debug("Error setting map style: "+n)}})}function i(e){var t={getTileUrl:function(t,n){return"http://"+e.user_name+".cartodb.com/tiles/"+e.table_name+"/"+n+"/"+t.x+"/"+t.y+".png?sql="+e.query},tileSize:new google.maps.Size(256,256),name:e.query,description:!1};e.layer=new google.maps.ImageMapType(t),e.map.overlayMapTypes.insertAt(0,e.layer)}function s(e){var t;e.tilejson=a(e),e.infowindow=new CartoDB.Infowindow(e),e.cache_buster=0,e.waxOptions={callbacks:{out:function(){e.map.setOptions({draggableCursor:"default"})},over:function(t,n,r,i){e.map.setOptions({draggableCursor:"pointer"})},click:function(t,n,r,i){e.infowindow.hideAll(),e.infowindow.open(t,i.latLng)}},clickAction:"full"},e.layer=new wax.g.connector(e.tilejson),e.map.overlayMapTypes.insertAt(0,e.layer),e.interaction=wax.g.interaction(e.map,e.tilejson,e.waxOptions)}function o(e,t){e.infowindow&&(e.cache_buster++,e.query=t,e.tilejson=a(e),f(e.map,e.layer),e.tilejson.grids=wax.util.addUrlData(e.tilejson.grids_base,"cache_buster="+e.cache_buster),e.layer=new wax.g.connector(e.tilejson),e.map.overlayMapTypes.insertAt(0,e.layer),e.interaction.remove(),e.interaction=wax.g.interaction(e.map,e.tilejson,e.waxOptions))}function u(e,t){if(!e.infowindow){f(e.map,e.layer),e.query=t;var n={getTileUrl:function(t,n){return"http://"+e.user_name+".cartodb.com/tiles/"+e.table_name+"/"+n+"/"+t.x+"/"+t.y+".png?sql="+e.query},tileSize:new google.maps.Size(256,256),name:e.query,description:!1};e.layer=new google.maps.ImageMapType(n),e.map.overlayMapTypes.insertAt(0,e.layer)}}function a(e){var t="http://"+e.user_name+".cartodb.com",n=t+"/tiles/"+e.table_name+"/{z}/{x}/{y}",r=n+".png?cache_buster=0",i=n+".grid.json";if(e.query){var s="sql="+e.query;r=wax.util.addUrlData(r,s),i=wax.util.addUrlData(i,s)}if(e.map_key){var o="map_key="+e.map_key;r=wax.util.addUrlData(r,o),i=wax.util.addUrlData(i,o)}if(e.tile_style){var u="style="+encodeURIComponent(e.tile_style);r=wax.util.addUrlData(r,u),i=wax.util.addUrlData(i,u)}return{blankImage:"blank_tile.png",tilejson:"1.0.0",scheme:"xyz",tiles:[r],grids:[i],tiles_base:r,grids_base:i,name:e.query,description:!0,formatter:function(e,t){return currentCartoDbId=t.cartodb_id,t.cartodb_id},cache_buster:function(){return e.cache_buster}}}function f(e,t){if(t){var n=-1;e.overlayMapTypes.forEach(function(e,r){t==e&&e.name==t.name&&e.description==t.description&&(n=r)}),n!=-1&&e.overlayMapTypes.removeAt(n),t=null}}this.params=t,this.params.feature=t.infowindow,this.params.map_style&&r(this.params),this.params.auto_bound&&n(this.params),this.params.infowindow?s(this.params):i(this.params),this.params.visible=!0,this.params.active=!0,google.maps.CartoDBLayer.prototype.update=function(e){this.params.infowindow&&this.params.infowindow.hide(),o(this.params,e),u(this.params,e),this.params.active=!0,this.params.visible=!0},google.maps.CartoDBLayer.prototype.destroy=function(){f(this.params.map,this.params.layer),this.params.infowindow&&(this.params.interaction.remove(),this.params.infowindow.hide()),this.params.active=!1},google.maps.CartoDBLayer.prototype.hide=function(){this.destroy(),this.params.visible=!1},google.maps.CartoDBLayer.prototype.show=function(){if(!this.params.visible||!this.params.active)this.update(this.params.query),this.params.visible=!0},google.maps.CartoDBLayer.prototype.isVisible=function(){return this.params.visible}}),CartoDB.Infowindow=function(e){this.latlng_=new google.maps.LatLng(0,0),this.feature_,this.map_=e.map,this.columns_,this.offsetHorizontal_=-107,this.width_=214,this.setMap(e.map),this.params_=e},CartoDB.Infowindow.prototype=new google.maps.OverlayView,CartoDB.Infowindow.prototype.draw=function(){var t=this,n=this.div_;if(!n){n=this.div_=document.createElement("DIV"),n.className="cartodb_infowindow",n.innerHTML='<a href="#close" class="close">x</a><div class="outer_top"><div class="top"></div></div><div class="bottom"><label>id:1</label></div>',e(n).find("a.close").click(function(e){e.preventDefault(),e.stopPropagation(),t.hide()}),google.maps.event.addDomListener(n,"click",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),google.maps.event.addDomListener(n,"dblclick",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),google.maps.event.addDomListener(n,"mousedown",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),google.maps.event.addDomListener(n,"mouseup",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),google.maps.event.addDomListener(n,"mousewheel",function(e){e.stopPropagation()}),google.maps.event.addDomListener(n,"DOMMouseScroll",function(e){e.stopPropagation()});var r=this.getPanes();r.floatPane.appendChild(n),n.style.opacity=0}var i=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(i){n.style.width=this.width_+"px",n.style.left=i.x-49+"px";var s=-e(n).height();n.style.top=i.y+s+5+"px"}},CartoDB.Infowindow.prototype.setPosition=function(){if(this.div_){var t=this.div_,n=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(n){t.style.width=this.width_+"px",t.style.left=n.x-49+"px";var r=-e(t).height();t.style.top=n.y+r+10+"px"}this.show()}},CartoDB.Infowindow.prototype.open=function(t,n){function s(i,s){if(r.div_){var o=r.div_;r.latlng_=n,e("div.cartodb_infowindow div.outer_top div.top").html(""),e("div.cartodb_infowindow div.outer_top div.bottom label").html("");for(p in i)p!="cartodb_id"&&p!="cdb_centre"&&p!="the_geom_webmercator"&&e("div.cartodb_infowindow div.outer_top div.top").append("<label>"+p+'</label><p class="'+(i[p]!=null&&i[p]!=""?"":"empty")+'">'+(i[p]||"empty")+"</p>");i.cartodb_id&&e("div.cartodb_infowindow div.bottom label").html("id: <strong>"+t+"</strong>"),r.moveMaptoOpen(),r.setPosition()}}var r=this,i="SELECT * FROM "+this.params_.table_name+" WHERE cartodb_id="+t;r.feature_=t,this.params_.feature!=1&&(i=encodeURIComponent(this.params_.feature.replace("{{feature}}",t))),e.ajax({url:"http://"+this.params_.user_name+".cartodb.com/api/v1/sql/?q="+i,dataType:"jsonp",timeout:2e3,callbackParameter:"callback",success:function(e){s(e.rows[0],n)},error:function(e,t){r.params_.debug&&console.debug("Error retrieving infowindow variables: "+t)}})},CartoDB.Infowindow.prototype.hide=function(){if(this.div_){var t=this.div_;e(t).animate({top:"+=10px",opacity:0},100,"swing",function(){t.style.visibility="hidden"})}},CartoDB.Infowindow.prototype.show=function(){if(this.div_){var t=this.div_;t.style.opacity=0,t.style.visibility="visible",e(t).animate({top:"-=10px",opacity:1},250)}},CartoDB.Infowindow.prototype.hideAll=function(){e("div.cartodb_infowindow").css("visibility","hidden")},CartoDB.Infowindow.prototype.isVisible=function(e){if(this.div_){var t=this.div_;return t.style.visibility=="visible"&&this.feature_!=null?!0:!1}return!1},CartoDB.Infowindow.prototype.transformGeoJSON=function(t){var n=e.parseJSON(t);return new google.maps.LatLng(n.coordinates[1],n.coordinates[0])},CartoDB.Infowindow.prototype.moveMaptoOpen=function(){var t=0,n=0,r=this.div_,i=this.getProjection().fromLatLngToContainerPixel(this.latlng_);i.x+this.offsetHorizontal_<0&&(t=i.x+this.offsetHorizontal_-20),i.x+180>=e("#"+this.params_.map_canvas).width()&&(t=i.x+180-e("#"+this.params_.map_canvas).width()),i.y-e(r).height()<0&&(n=i.y-e(r).height()-30),this.map_.panBy(t,n)}})(jQuery);var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,t){var t=t||document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(t,n,r){if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===t.length+0){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i)===this.BREAK)break}else for(i in t)if(n.call(r,t[i],i)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}(),dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(dat.utils.common),dat.dom.dom=function(e){function t(t){return t==="0"||e.isUndefined(t)?0:(t=t.match(r),e.isNull(t)?0:parseFloat(t[1]))}var n={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/,i={makeSelectable:function(e,t){e!==void 0&&e.style!==void 0&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,r){e.isUndefined(n)&&(n=!0),e.isUndefined(r)&&(r=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,i,s){var i=i||{},o=n[r];if(!o)throw Error("Event type "+r+" not supported.");var u=document.createEvent(o);switch(o){case"MouseEvents":u.initMouseEvent(r,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,i.x||i.clientX||0,i.y||i.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":o=u.initKeyboardEvent||u.initKeyEvent,e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),o(r,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:u.initEvent(r,i.bubbles||!1,i.cancelable||!0)}e.defaults(u,s),t.dispatchEvent(u)},bind:function(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n),i},unbind:function(e,t,n,r){return e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n),i},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(e,t){if(t){if(e.className!==void 0)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))}}else e.className=void 0;return i},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return e=getComputedStyle(e),t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return e=getComputedStyle(e),t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return i}(dat.utils.common),dat.controllers.OptionController=function(e,t,n){var r=function(e,i,s){r.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(n.isArray(s)){var u={};n.each(s,function(e){u[e]=e}),s=u}n.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){o.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,t){var n=function(e,r,i){n.superclass.call(this,e,r),i=i||{},this.__min=i.min,this.__max=i.max,this.__step=i.step,e=this.__impliedStep=t.isUndefined(this.__step)?this.initialValue==0?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,e=e.toString(),this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return this.__min!==void 0&&e<this.__min?e=this.__min:this.__max!==void 0&&e>this.__max&&(e=this.__max),this.__step!==void 0&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,t,n){var r=function(e,i,s){function o(){var e=parseFloat(l.__input.value);n.isNaN(e)||l.setValue(e)}function u(e){var t=h-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),h=e.clientY}function f(){t.unbind(window,"mousemove",u),t.unbind(window,"mouseup",f)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,s);var l=this,h;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",o),t.bind(this.__input,"blur",function(){o(),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}),t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",u),t.bind(window,"mouseup",f),h=e.clientY}),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){var e=this.__input,t;if(this.__truncationSuspended)t=this.getValue();else{t=this.getValue();var n=Math.pow(10,this.__precision);t=Math.round(t*n)/n}return e.value=t,r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,t,n,r,i){var s=function(e,n,r,i,o){function u(e){e.preventDefault();var n=t.getOffset(l.__background),r=t.getWidth(l.__background);return l.setValue(l.__min+(l.__max-l.__min)*((e.clientX-n.left)/(n.left+r-n.left))),!1}function f(){t.unbind(window,"mousemove",u),t.unbind(window,"mouseup",f),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}s.superclass.call(this,e,n,{min:r,max:i,step:o});var l=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",u),t.bind(window,"mouseup",f),u(e)}),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return s.superclass=e,s.useDefaultStyles=function(){n.inject(i)},r.extend(s.prototype,e.prototype,{updateDisplay:function(){return this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%",s.superclass.prototype.updateDisplay.call(this)}}),s}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var s=this;this.__button=document.createElement("div"),this.__button.innerHTML=i===void 0?"Fire":i,t.bind(this.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return r.superclass=e,n.extend(r.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,t,n){var r=function(e,n){r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){for(t=t.hex.toString(16);t.length<6;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common),dat.color.interpret=function(e,t){var n,r,i=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9]{6})$/i),e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:e},CSS_RGB:{read:function(e){return e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){return e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!=3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!=4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){r=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(i,function(i){if(i.litmus(e))return t.each(i.conversions,function(i,s){n=i.read(e);if(r===!1&&n!==!1)return r=n,n.conversionName=s,n.conversion=i,t.BREAK}),t.BREAK}),r}}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function v(e,t,n,s){if(t[n]===void 0)throw Error("Object "+t+' has no property "'+n+'"');s.color?t=new l(t,n):(t=[t,n].concat(s.factoryArgs),t=r.apply(e,t)),s.before instanceof i&&(s.before=s.before.__li),y(e,t),p.addClass(t.domElement,"c"),n=document.createElement("span"),p.addClass(n,"property-name"),n.innerHTML=t.property;var o=document.createElement("div");return o.appendChild(n),o.appendChild(t.domElement),s=m(e,o,s.before),p.addClass(s,P.CLASS_CONTROLLER_ROW),p.addClass(s,typeof t.getValue()),g(e,s,t),e.__controllers.push(t),t}function m(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,params.before):e.__ul.appendChild(r),e.onResize(),r}function g(e,t,n){n.__li=t,n.__gui=e,d.extend(n,{options:function(t){if(arguments.length>1)return n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]});if(d.isArray(t)||d.isObject(t))return n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}});if(n instanceof a){var r=new u(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),i.apply(r,e)}}),p.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof u){var i=function(t){return d.isNumber(n.__min)&&d.isNumber(n.__max)?(n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=d.compose(i,n.min),n.max=d.compose(i,n.max)}else n instanceof s?(p.bind(t,"click",function(){p.fakeEvent(n.__checkbox,"click")}),p.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof o?(p.bind(t,"click",function(){p.fakeEvent(n.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(n.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(n.__button,"hover")})):n instanceof l&&(p.addClass(t,"color"),n.updateDisplay=d.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=d.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&T(e.getRoot(),!0),t},n.setValue)}function y(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(r!=-1){var i=n.__rememberedObjectIndecesToControllers[r];i===void 0&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t;if(n.load&&n.load.remembered){n=n.load.remembered;if(n[e.preset])n=n[e.preset];else{if(!n[C])return;n=n[C]}n[r]&&n[r][t.property]!==void 0&&(r=n[r][t.property],t.initialValue=r,t.setValue(r))}}}function b(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),p.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",p.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",p.addClass(r,"button"),p.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",p.addClass(i,"button"),p.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",p.addClass(s,"button"),p.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?d.each(e.load.remembered,function(t,n){x(e,n,n==e.preset)}):x(e,C,!1),p.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s);if(k){var t=document.getElementById("dg-save-locally"),u=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),localStorage.getItem(document.location.href+".isLocal")==="true"&&t.setAttribute("checked","checked");var a=function(){u.style.display=e.useLocalStorage?"block":"none"};a(),p.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,a()})}var f=document.getElementById("dg-new-constructor");p.bind(f,"keydown",function(e){e.metaKey&&(e.which===67||e.keyCode==67)&&A.hide()}),p.bind(n,"click",function(){f.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),A.show(),f.focus(),f.select()}),p.bind(r,"click",function(){e.save()}),p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(s,"click",function(){e.revert()})}function w(e){function t(t){return t.preventDefault(),i=t.clientX,p.addClass(e.__closeButton,P.CLASS_DRAG),p.bind(window,"mousemove",n),p.bind(window,"mouseup",r),!1}function n(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function r(){p.removeClass(e.__closeButton,P.CLASS_DRAG),p.unbind(window,"mousemove",n),p.unbind(window,"mouseup",r)}e.__resize_handle=document.createElement("div"),d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var i;p.bind(e.__resize_handle,"mousedown",t),p.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function E(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function S(e,t){var n={};return d.each(e.__rememberedObjects,function(r,i){var s={};d.each(e.__rememberedObjectIndecesToControllers[i],function(e,n){s[n]=t?e.initialValue:e.getValue()}),n[i]=s}),n}function x(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function T(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function N(e){e.length!=0&&c(function(){N(e)}),d.each(e,function(e){e.updateDisplay()})}e.inject(n);var C="Default",k;try{k="localStorage"in window&&window.localStorage!==null}catch(L){k=!1}var A,O=!0,M,_=!1,D=[],P=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(r.getSaveObject()))}function n(){var e=r.getRoot();e.width+=1,d.defer(function(){e.width-=1})}var r=
this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=d.defaults(e,{autoPlace:!0,width:P.DEFAULT_WIDTH}),e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),d.isUndefined(e.load)?e.load={preset:C}:e.preset&&(e.load.preset=e.preset),d.isUndefined(e.parent)&&e.hideable&&D.push(this),e.resizable=d.isUndefined(e.parent)&&e.resizable,e.autoPlace&&d.isUndefined(e.scrollable)&&(e.scrollable=!0);var i=k&&localStorage.getItem(document.location.href+".isLocal")==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return r.parent?r.getRoot().preset:e.load.preset},set:function(t){r.parent?r.getRoot().preset=t:e.load.preset=t;for(t=0;t<this.__preset_select.length;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);r.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,E(r,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,o&&(o.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?p.addClass(r.__ul,P.CLASS_CLOSED):p.removeClass(r.__ul,P.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?P.TEXT_OPEN:P.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return i},set:function(e){k&&((i=e)?p.bind(window,"unload",t):p.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}});if(d.isUndefined(e.parent)){e.closed=!1,p.addClass(this.domElement,P.CLASS_MAIN),p.makeSelectable(this.domElement,!1);if(k&&i){r.useLocalStorage=!0;var s=localStorage.getItem(document.location.href+".gui");s&&(e.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=P.TEXT_CLOSED,p.addClass(this.__closeButton,P.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{e.closed===void 0&&(e.closed=!0);var o=document.createTextNode(e.name);p.addClass(o,"controller-name"),s=m(r,o),p.addClass(this.__ul,P.CLASS_CLOSED),p.addClass(s,"title"),p.bind(s,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),e.closed||(this.closed=!1)}e.autoPlace&&(d.isUndefined(e.parent)&&(O&&(M=document.createElement("div"),p.addClass(M,"dg"),p.addClass(M,P.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(M),O=!1),M.appendChild(this.domElement),p.addClass(this.domElement,P.CLASS_AUTO_PLACE)),this.parent||E(r,e.width)),p.bind(window,"resize",function(){r.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){r.onResize()}),p.bind(this.__ul,"transitionend",function(){r.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){r.onResize()}),this.onResize(),e.resizable&&w(this),r.getRoot(),e.parent||n()};return P.toggleHide=function(){_=!_,d.each(D,function(e){e.domElement.style.zIndex=_?-999:999,e.domElement.style.opacity=_?0:1})},P.CLASS_AUTO_PLACE="a",P.CLASS_AUTO_PLACE_CONTAINER="ac",P.CLASS_MAIN="main",P.CLASS_CONTROLLER_ROW="cr",P.CLASS_TOO_TALL="taller-than-window",P.CLASS_CLOSED="closed",P.CLASS_CLOSE_BUTTON="close-button",P.CLASS_DRAG="drag",P.DEFAULT_WIDTH=245,P.TEXT_CLOSED="Close Controls",P.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){document.activeElement.type!=="text"&&(e.which===72||e.keyCode==72)&&P.toggleHide()},!1),d.extend(P.prototype,{add:function(e,t){return v(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return v(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&M.removeChild(this.domElement)},addFolder:function(e){if(this.__folders[e]!==void 0)throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new P(t),this.__folders[e]=t,e=m(this,t.domElement),p.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,n=0;d.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=p.getHeight(t))}),window.innerHeight-t-20<n?(p.addClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(p.removeClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){d.isUndefined(A)&&(A=new h,A.domElement.innerHTML=t);if(this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;d.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length==0&&b(e),e.__rememberedObjects.indexOf(t)==-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&E(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=S(this)),e.folders={},d.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=S(this),T(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[C]=S(this,!0)),this.load.remembered[e]=S(this),this.preset=e,x(this,e,!0)},revert:function(e){d.each(this.__controllers,function(t){this.getRoot().load.remembered?y(e||this.getRoot(),t):t.setValue(t.initialValue)},this),d.each(this.__folders,function(e){e.revert(e)}),e||T(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e),t&&N(this.__listening)}}),P}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(e,t,n,r,i,s,o){return function(u,l,h,p){var v=u[l];if(o.isArray(h)||o.isObject(h))return new e(u,l,h);if(o.isNumber(v))return o.isNumber(h)&&o.isNumber(p)?new n(u,l,h,p):new t(u,l,{min:h,max:p});if(o.isString(v))return new r(u,l);if(o.isFunction(v))return new i(u,l,"");if(o.isBoolean(v))return new s(u,l)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var r=function(e,n){function i(){s.setValue(s.__input.value)}r.superclass.call(this,e,n);var s=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",i),t.bind(this.__input,"change",i),t.bind(this.__input,"blur",function(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,r,i){function s(e,t,n,r){e.style.background="",i.each(a,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function o(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var u=function(e,a){function l(e){g(e),t.bind(window,"mousemove",g),t.bind(window,"mouseup",p)}function p(){t.unbind(window,"mousemove",g),t.unbind(window,"mouseup",p)}function v(){var e=r(this.value);e!==!1?(w.__color.__state=e,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function m(){t.unbind(window,"mousemove",y),t.unbind(window,"mouseup",m)}function g(e){e.preventDefault();var n=t.getWidth(w.__saturation_field),r=t.getOffset(w.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/n,e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),i>1?i=1:i<0&&(i=0),w.__color.v=e,w.__color.s=i,w.setValue(w.__color.toOriginal()),!1}function y(e){e.preventDefault();var n=t.getHeight(w.__hue_field),r=t.getOffset(w.__hue_field),e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),w.__color.h=e*360,w.setValue(w.__color.toOriginal()),!1}u.superclass.call(this,e,a),this.__color=new n(this.getValue()),this.__temp=new n(0);var w=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){e.keyCode===13&&v.call(this)}),t.bind(this.__input,"blur",v),t.bind(this.__selector,"mousedown",function(){t.addClass(this,"drag").bind(window,"mouseup",function(){t.removeClass(w.__selector,"drag")})});var E=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(E.style,{width:"100%",height:"100%",background:"none"}),s(E,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),o(this.__hue_field),i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",l),t.bind(this.__field_knob,"mousedown",l),t.bind(this.__hue_field,"mousedown",function(e){y(e),t.bind(window,"mousemove",y),t.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(E),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};u.superclass=e,i.extend(u.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(e!==!1){var t=!1;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,u=255-o;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+u+","+u+","+u+",.7)"})}});var a=["-moz-","-o-","-webkit-","-ms-",""];return u}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,r){function i(e,t,n){Object.defineProperty(e,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(o(this,t,n),this.__state[t])},set:function(e){this.__state.space!=="RGB"&&(o(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function s(e,t){Object.defineProperty(e,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(u(this),this.__state[t])},set:function(e){this.__state.space!=="HSV"&&(u(this),this.__state.space="HSV"),this.__state[t]=e}})}function o(e,n,i){if(e.__state.space==="HEX")e.__state[n]=t.component_from_hex(e.__state.hex,i);else{if(e.__state.space!=="HSV")throw"Corrupted color state";r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function u(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v}),r.isNaN(n.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var a=function(){this.__state=e.apply(this,arguments);if(this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return a.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),r.extend(a.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),i(a.prototype,"r",2),i(a.prototype,"g",1),i(a.prototype,"b",0),s(a.prototype,"h"),s(a.prototype,"s"),s(a.prototype,"v"),Object.defineProperty(a.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(a.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),a}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=e/60-Math.floor(e/60),i=n*(1-t),s=n*(1-r*t),t=n*(1-(1-r)*t),e=[[n,t,i],[s,n,i],[i,n,t],[i,s,n],[t,i,n],[n,i,s]][Math.floor(e/60)%6];return{r:e[0]*255,g:e[1]*255,b:e[2]*255}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),r=i-r;return i==0?{h:NaN,s:0,v:0}:(e=e==i?(t-n)/r:t==i?2+(n-e)/r:4+(e-t)/r,e/=6,e<0&&(e+=1),{h:e*360,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,n,r){return r<<(e=n*8)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common),function(){function e(t,n,r){if(t===n)return t!==0||1/t==1/n;if(t==null||n==null)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:t==0?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if(typeof t!="object"||typeof n!="object")return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if(i=="[object Array]"){if(s=t.length,o=s==n.length)for(;s--;)if(!(o=s in t==s in n&&e(t[s],n[s],r)))break}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new L(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.1";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e))return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e))return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){r==0?t[0]=e:(n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e)}),t},E.sortBy=function(e,t,n){return E.pluck(E.map(e,function(e,r,i){return{value:e,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?e.toArray?e.toArray():E.isArray(e)?o.call(e):E.isArguments(e)?o.call(e):E.values(e):[]},E.size=function(e){return E.toArray(e).length},E.first=E.head=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return E.reduce(n,function(n,i,s){if(0==s||(t===!0?E.last(n)!=i:!E.include(n,i)))n[n.length]=i,r[r.length]=e[s];return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1));return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(e,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u=E.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var a;i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),u()},t)),s?o=!0:e.apply(n,r),u(),s=!0}},E.debounce=function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(r,i)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(
e){if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.mixin=function(e){S(E.functions(e),function(t){O(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k=function(e){return e.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};E.template=function(e,t){var n=E.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape||C,function(e,t){return"',_.escape("+k(t)+"),'"}).replace(n.interpolate||C,function(e,t){return"',"+k(t)+",'"}).replace(n.evaluate||C,function(e,t){return"');"+k(t).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",r=new Function("obj","_",n);return t?r(t,E):function(e){return r.call(this,e,E)}},E.chain=function(e){return E(e).chain()};var L=function(e){this._wrapped=e};E.prototype=L.prototype;var A=function(e,t){return t?E(e).chain():e},O=function(e,t){L.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),A(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];L.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],A(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];L.prototype[e]=function(){return A(t.apply(this._wrapped,arguments),this._chain)}}),L.prototype.chain=function(){return this._chain=!0,this},L.prototype.value=function(){return this._wrapped}}.call(this),function(){var e=this,t=e.Backbone,n;typeof exports!="undefined"?n=exports:n=e.Backbone={},n.VERSION="0.5.3";var r=e._;!r&&typeof require!="undefined"&&(r=require("underscore")._);var i=e.jQuery||e.Zepto||e.ender;n.noConflict=function(){return e.Backbone=t,this},n.emulateHTTP=!1,n.emulateJSON=!1,n.Events={bind:function(e,t,n){var r=this._callbacks||(this._callbacks={}),i=r[e]||(r[e]=[]);return i.push([t,n]),this},unbind:function(e,t){var n;if(!e)this._callbacks={};else if(n=this._callbacks)if(!t)n[e]=[];else{var r=n[e];if(!r)return this;for(var i=0,s=r.length;i<s;i++)if(r[i]&&t===r[i][0]){r[i]=null;break}}return this},trigger:function(e){var t,n,r,i,s,o=2;if(!(n=this._callbacks))return this;while(o--){r=o?e:"all";if(t=n[r])for(var u=0,a=t.length;u<a;u++)(i=t[u])?(s=o?Array.prototype.slice.call(arguments,1):arguments,i[0].apply(i[1]||this,s)):(t.splice(u,1),u--,a--)}return this}},n.Model=function(e,t){var n;e||(e={});if(n=this.defaults)r.isFunction(n)&&(n=n.call(this)),e=r.extend({},n,e);this.attributes={},this._escapedAttributes={},this.cid=r.uniqueId("c"),this.set(e,{silent:!0}),this._changed=!1,this._previousAttributes=r.clone(this.attributes),t&&t.collection&&(this.collection=t.collection),this.initialize(e,t)},r.extend(n.Model.prototype,n.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.attributes[e];return this._escapedAttributes[e]=S(n==null?"":""+n)},has:function(e){return this.attributes[e]!=null},set:function(e,t){t||(t={});if(!e)return this;e.attributes&&(e=e.attributes);var n=this.attributes,i=this._escapedAttributes;if(!t.silent&&this.validate&&!this._performValidation(e,t))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);var s=this._changing;this._changing=!0;for(var o in e){var u=e[o];r.isEqual(n[o],u)||(n[o]=u,delete i[o],this._changed=!0,t.silent||this.trigger("change:"+o,this,u,t))}return!s&&!t.silent&&this._changed&&this.change(t),this._changing=!1,this},unset:function(e,t){if(e in this.attributes){t||(t={});var n=this.attributes[e],r={};return r[e]=void 0,!t.silent&&this.validate&&!this._performValidation(r,t)?!1:(delete this.attributes[e],delete this._escapedAttributes[e],e==this.idAttribute&&delete this.id,this._changed=!0,t.silent||(this.trigger("change:"+e,this,void 0,t),this.change(t)),this)}return this},clear:function(e){e||(e={});var t,n=this.attributes,r={};for(t in n)r[t]=void 0;if(!e.silent&&this.validate&&!this._performValidation(r,e))return!1;this.attributes={},this._escapedAttributes={},this._changed=!0;if(!e.silent){for(t in n)this.trigger("change:"+t,this,void 0,e);this.change(e)}return this},fetch:function(e){e||(e={});var t=this,r=e.success;return e.success=function(n,i,s){if(!t.set(t.parse(n,s),e))return!1;r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"read",this,e)},save:function(e,t){t||(t={});if(e&&!this.set(e,t))return!1;var r=this,i=t.success;t.success=function(e,n,s){if(!r.set(r.parse(e,s),t))return!1;i&&i(r,e,s)},t.error=E(t.error,r,t);var s=this.isNew()?"create":"update";return(this.sync||n.sync).call(this,s,this,t)},destroy:function(e){e||(e={});if(this.isNew())return this.trigger("destroy",this,this.collection,e);var t=this,r=e.success;return e.success=function(n){t.trigger("destroy",t,t.collection,e),r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"delete",this,e)},url:function(){var e=b(this.collection)||this.urlRoot||w();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(e){this.trigger("change",this,e),this._previousAttributes=r.clone(this.attributes),this._changed=!1},hasChanged:function(e){return e?this._previousAttributes[e]!=this.attributes[e]:this._changed},changedAttributes:function(e){e||(e=this.attributes);var t=this._previousAttributes,n=!1;for(var i in e)r.isEqual(t[i],e[i])||(n=n||{},n[i]=e[i]);return n},previous:function(e){return!e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return r.clone(this._previousAttributes)},_performValidation:function(e,t){var n=this.validate(e);return n?(t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}}),n.Collection=function(e,t){t||(t={}),t.comparator&&(this.comparator=t.comparator),r.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),e&&this.reset(e,{silent:!0}),this.initialize.apply(this,arguments)},r.extend(n.Collection.prototype,n.Events,{model:n.Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,t){if(r.isArray(e))for(var n=0,i=e.length;n<i;n++)this._add(e[n],t);else this._add(e,t);return this},remove:function(e,t){if(r.isArray(e))for(var n=0,i=e.length;n<i;n++)this._remove(e[n],t);else this._remove(e,t);return this},get:function(e){return e==null?null:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return r.map(this.models,function(t){return t.get(e)})},reset:function(e,t){return e||(e=[]),t||(t={}),this.each(this._removeReference),this._reset(),this.add(e,{silent:!0}),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e||(e={});var t=this,r=e.success;return e.success=function(n,i,s){t[e.add?"add":"reset"](t.parse(n,s),e),r&&r(t,n)},e.error=E(e.error,t,e),(this.sync||n.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var r=t.success;return t.success=function(e,i,s){n.add(e,t),r&&r(e,i,s)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return r(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof n.Model)e.collection||(e.collection=this);else{var r=e;e=new this.model(r,{collection:this}),e.validate&&!e._performValidation(r,t)&&(e=!1)}return e},_add:function(e,t){t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var n=this.getByCid(e);if(n)throw new Error(["Can't add the same model to a set twice",n.id]);this._byId[e.id]=e,this._byCid[e.cid]=e;var r=t.at!=null?t.at:this.comparator?this.sortedIndex(e,this.comparator):this.length;return this.models.splice(r,0,e),e.bind("all",this._onModelEvent),this.length++,t.silent||e.trigger("add",e,this,t),e},_remove:function(e,t){return t||(t={}),e=this.getByCid(e)||this.get(e),e?(delete this._byId[e.id],delete this._byCid[e.cid],this.models.splice(this.indexOf(e),1),this.length--,t.silent||e.trigger("remove",e,this,t),this._removeReference(e),e):null},_removeReference:function(e){this==e.collection&&delete e.collection,e.unbind("all",this._onModelEvent)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this._remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var s=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];r.each(s,function(e){n.Collection.prototype[e]=function(){return r[e].apply(r,[this.models].concat(r.toArray(arguments)))}}),n.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var o=/:([\w\d]+)/g,u=/\*([\w\d]+)/g,a=/[-[\]{}()+?.,\\^$|#\s]/g;r.extend(n.Router.prototype,n.Events,{initialize:function(){},route:function(e,t,i){n.history||(n.history=new n.History),r.isRegExp(e)||(e=this._routeToRegExp(e)),n.history.route(e,r.bind(function(n){var r=this._extractParameters(e,n);i.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r))},this))},navigate:function(e,t){n.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(a,"\\$&").replace(o,"([^/]*)").replace(u,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),n.History=function(){this.handlers=[],r.bindAll(this,"checkUrl")};var f=/^#*/,l=/msie [\w.]+/,c=!1;r.extend(n.History.prototype,{interval:50,getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=window.location.hash;return e=decodeURIComponent(e.replace(f,"")),e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e},start:function(e){if(c)throw new Error("Backbone.history has already been started");this.options=r.extend({},{root:"/"},this.options,e),this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,s=l.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);s&&(this.iframe=i('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?i(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!s?i(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=t,c=!0;var o=window.location,u=o.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=o.hash.replace(f,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.iframe.location.hash));if(t==this.fragment||t==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=r.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){var n=(e||"").replace(f,"");if(this.fragment==n||this.fragment==decodeURIComponent(n))return;if(this._hasPushState){var r=window.location;n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history.pushState({},document.title,r.protocol+"//"+r.host+n)}else window.location.hash=this.fragment=n,this.iframe&&n!=this.getFragment(this.iframe.location.hash)&&(this.iframe.document.open().close(),this.iframe.location.hash=n);t&&this.loadUrl(e)}}),n.View=function(e){this.cid=r.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var h=function(e){return i(e,this.el)},p=/^(\S+)\s*(.*)$/,d=["model","collection","el","id","attributes","className","tagName"];r.extend(n.View.prototype,n.Events,{tagName:"div",$:h,initialize:function(){},render:function(){return this},remove:function(){return i(this.el).remove(),this},make:function(e,t,n){var r=document.createElement(e);return t&&i(r).attr(t),n&&i(r).html(n),r},delegateEvents:function(e){if(!e&&!(e=this.events))return;r.isFunction(e)&&(e=e.call(this)),i(this.el).unbind(".delegateEvents"+this.cid);for(var t in e){var n=this[e[t]];if(!n)throw new Error('Event "'+e[t]+'" does not exist');var s=t.match(p),o=s[1],u=s[2];n=r.bind(n,this),o+=".delegateEvents"+this.cid,u===""?i(this.el).bind(o,n):i(this.el).delegate(u,o,n)}},_configure:function(e){this.options&&(e=r.extend({},this.options,e));for(var t=0,n=d.length;t<n;t++){var i=d[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=this.attributes||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.el=this.make(this.tagName,e)}else r.isString(this.el)&&(this.el=i(this.el).get(0))}});var v=function(e,t){var n=y(this,e,t);return n.extend=this.extend,n};n.Model.extend=n.Collection.extend=n.Router.extend=n.View.extend=v;var m={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};n.sync=function(e,t,s){var o=m[e],u=r.extend({type:o,dataType:"json"},s);return u.url||(u.url=b(t)||w()),!u.data&&t&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),n.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),n.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(n.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!n.emulateJSON&&(u.processData=!1),i.ajax(u)};var g=function(){},y=function(e,t,n){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){return e.apply(this,arguments)},r.extend(i,e),g.prototype=e.prototype,i.prototype=new g,t&&r.extend(i.prototype,t),n&&r.extend(i,n),i.prototype.constructor=i,i.__super__=e.prototype,i},b=function(e){return!e||!e.url?null:r.isFunction(e.url)?e.url():e.url},w=function(){throw new Error('A "url" property or function must be specified')},E=function(e,t,n){return function(r){e?e(t,r,n):t.trigger("error",t,r,n)}},S=function(e){return e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}.call(this),function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=Class.implement=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.constructor=o,o.extend=arguments.callee,o.implement=arguments.callee,o}}(),Backbone.CartoDB=function(e,t,n){function r(e){this.sql=e}function s(e){return new r(e)}e=_.defaults(e,{USE_PROXY:!1,user:""}),r.prototype.format=function(){var e=this.sql,t=arguments.length+1,n,r;for(i=0;i<t;r=arguments[i++])n=typeof r=="object"?JSON.stringify(r):r,e=e.replace(RegExp("\\{"+(i-1)+"\\}","g"),n);return e};var o="d2c5ry9dy1ewvi.cloudfront.net/api/v1/sql",u="https://"+o;t=t||function(e,n,r){var i=u,s=!0;r&&(i="api/v0/proxy/"+u,s=!1),e.length>1500?$.ajax({url:i,crossDomain:s,type:"POST",dataType:"json",data:"q="+encodeURIComponent(e),success:n,error:function(){r?n():USE_PROXY&&t(e,n,!0)}}):$.getJSON(u+"?q="+encodeURIComponent(e)+"&callback=?").success(n).fail(function(){n()}).complete(function(){})};var a={setItem:function(e,t){},getItem:function(e){return null},removeItem:function(e){}};n=n&&a;var f=Backbone.Model.extend({_create_sql:function(){var e=s(" where {0} = '{1}'").format(this.columns[this.what],this.get(this.what).replace("'","''")),t=this._sql_select(),n="select "+t.join(",")+" from "+this.table+e;return n},_sql_select:function(){var e=[];for(var t in this.columns){var n=this.columns[t];n.indexOf("ST_")!==-1||n==="the_geom"?e.push(s("ST_AsGeoJSON({1}) as {0}").format(t,n)):e.push(s("{1} as {0}").format(t,n))}return e},_parse_columns:function(e){var t={};for(var n in e){var r=e[n],i=this.columns[n];i.indexOf("ST_")!==-1||i==="the_geom"?t[n]=JSON.parse(r):t[n]=e[n]}return t},fetch:function(){var e=this;t(this._create_sql(),function(t){e.set(e._parse_columns(t.rows[0]))})}}),l=Backbone.Collection.extend({_create_sql:function(){var e=this.table;_.isArray(this.table)||(e=[this.table]),e=e.join(",");var t=f.prototype._sql_select.call(this),n="select "+t.join(",")+" from "+this.table;return this.where&&(n+=" WHERE "+this.where),n},fetch:function(){var e=this,r=this.sql||this._create_sql();typeof r=="function"&&(r=r.call(this));var i=this.cache?n.getItem(r):!1;i?e.reset(JSON.parse(i)):t(r,function(t){if(this.cache)try{n.setItem(r,JSON.stringify(t.rows))}catch(i){}var s;e.sql?s=t.rows:s=_.map(t.rows,function(t){return f.prototype._parse_columns.call(e,t)}),e.reset(s)})}});return{query:t,CartoDBCollection:l,CartoDBModel:f,SQL:s}};